<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=geometry&sensor=false&language=ar"></script>

<style type="text/css">
#slider{
  position: absolute;
  bottom: 50px;
  width: 90%;
  left: 50px;
}

#categories{
  position: absolute;
  top: 50px;
  right: 50px;
  padding: 10px;
  width: 200px;
}

.red{
width: 20px;
height: 20px;
background-color: red;
display: inline-block;
margin: 0 4px 0 0;
margin-bottom: -4px;
}
.blue{
width: 20px;
height: 20px;
background-color: blue;
display: inline-block;
margin: 0 4px 0 0;
margin-bottom: -4px;
}
</style>
  </head>
  <body>
    <div class="container map" id="map-canvas" style="width:100%; height:1400px"></div>
    <div id="slider"></div>
    <div id="categories" class="well">
      <div class="cat">
        <span class="red"></span><span class="text">Crime</span>
      </div>
      <div class="cat">
        <span class="blue"></span><span class="text">Crime2</span>
      </div>
    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>

    <script type="text/javascript">
    var map;
    var incidents;
	function initialize() {
	  // Create a simple map.
	  map = new google.maps.Map(document.getElementById('map-canvas'), {
	    zoom: 6,
	    center: {lat: 21.8357675, lng: 30.7956597}
	  });

    incidents = $.ajax({
      url:"http://local:8000/uji.egypt/incidents.json",
      dataType:"json",
      async:false
    }).responseJSON.payload.incidents;

      console.log(incidents);

    //loadGeoJson  runs asnchronously, listen to the addfeature-event
    google.maps.event.addListener(map.data,'addfeature',function(e){

      var point = new google.maps.LatLng(
        incidents[0].incident.locationlatitude,
        incidents[0].incident.locationlongitude);

      //check for a polygon
      if(e.feature.getGeometry().getType()==='Polygon'){

        // if(google.maps.geometry.poly.containsLocation(point, e.feature.getGeometry() )){
        //   console('contains: ');
        // }

        //initialize the bounds
        //var bounds=new google.maps.LatLngBounds();

        //iterate over the paths
        var me = [];
        e.feature.getGeometry().getArray().forEach(function(path){


          //iterate over the points in the path
          path.getArray().forEach(function(latLng){

            //extend the bounds

            //bounds.extend(latLng);
            me.push(latLng);
          });

        });
        console.log(me);

        bermudaTriangle = new google.maps.Polygon({
          paths: me,
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35
        });
        //
        // //bermudaTriangle.setMap(map);
        //
        //
        // var marker = new google.maps.Marker({
        //   position: point,
        //   map: map,
        //   title: 'Hello World!'
        // });
        //
        if(google.maps.geometry.poly.containsLocation(point, bermudaTriangle )){
            console('contains: ');
          }

        // var point = new google.maps.LatLng(
        //   incidents[0].incident.locationlongitude,
        //   incidents[0].incident.locationlatitude);
        //
        // var polygon = new google.maps.Polygon({paths: me});
        //
        // if(google.maps.geometry.poly.containsLocation(point, polygon )){
        //   console('contains: ');
        // }

        //now use the bounds
        //e.feature.setProperty('bounds',bounds);

      }
    });


    map.data.loadGeoJson('/uji.egypt/egypt.geojson');
    map.data.loadGeoJson('/uji.egypt/cairo.geojson');


//     setTimeout(function(){
//     //console.log(map.data);
//     $.getJSON( "http://local:8000/uji.egypt/incidents.json", function( data ) {
//       var items = [];
//
//       $.each( data.payload.incidents, function( key, val ) {
//         //items.push( "<li id='" + key + "'>" + val + "</li>" );
//         var point = new google.maps.LatLng(val.incident.locationlongitude,val.incident.locationlatitude);
//         console.log(point);
//
//         map.data.forEach(function(feature){
//
//           //console.log(feature);
//           if(feature.getGeometry().getType() == 'Polygon'){
//             //console.log(feature.getGeometry().getArray());
//             x = new google.maps.Polygon({path: feature.getGeometry().getArray()});
//             if(google.maps.geometry.poly.containsLocation(point, x )){
//               console('contains: ' + e.latLng);
//             }
//           }
//
//
//         });
//
//
//
//       });
//
//       // map.data.forEach(function(feature){
//       //   if(feature.getGeometry().getType() == 'Polygon'){
//       //   x = new google.maps.Polygon({path: feature.getGeometry().getArray()});
//       //   console.log(x);
//       // }
//       //
//       // });
//
//
//     });
//
// }, 2000);

    //map.data.loadGeoJson('/uji.egypt/merge.json');

	  // Load a GeoJSON from the same server as our demo.
	  //map.data.loadGeoJson('https://storage.googleapis.com/maps-devrel/google.json');
	  //map.data.loadGeoJson('/uji.egypt/merge.json');
	}

	google.maps.event.addDomListener(window, 'load', initialize);


  $(function() {
    $( "#slider" ).slider();
  });
    </script>
  </body>
</html>
